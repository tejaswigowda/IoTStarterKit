
<html>

<head>
  <script src='script.js'> </script>
<script>
var chart;
function start()
{
	// set date-time;

   chart = c3.generate({
       bindto: '#chart',
       data: {
          columns: [[]]
       }
    });
	loadGraph();
	setInterval(loadGraph, 3000);
}

var lastTimeStamp = 0;
function loadGraph()
{
  loadURL("./getData", function(res){
    var data = JSON.parse(res);
    currTimeStamp = data[0].ts;
    if(currTimeStamp === lastTimeStamp){
        return;
    }
    var cols = [
      ['Temp'],
      ['Humidity']
    ];

    for (var i = data.length-1; i>=0; i--){
      var row = data[i];
      cols[0].push(row.t);
      cols[1].push(row.h);
    }

    chart.load({
       columns: cols
    });
    lastTimeStamp = data[0].ts;
  });
}
</script>
</head>

<body onload='start()'>
  <h1> Temp/Humidity Monitor</h1>

  <div id="chart"></div>
</body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
</html>
